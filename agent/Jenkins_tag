pipeline {
    agent any
    
    environment {
        AWS_DEFAULT_REGION = 'your_region'
    }
    
    stages {
        stage('Find Instance IDs') {
            steps {
                script {
                  sh '''
                    missing_owner_instances=$(aws ec2 describe-instances   --output text   --query 'Reservations[].Instances[?!not_null(Tags[?Key == `owner`].Value)] | [].[InstanceId]')
                      if [[ -z $missing_owner_instances ]]; then
                            echo "All instances have the 'Owner' tag attached."
                      else
                             echo "Instances without the 'Owner' tag:"
                              echo "$missing_owner_instances"
                      fi
                      '''
                    }
                }
            }
        }
    }
}
